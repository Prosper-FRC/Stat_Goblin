<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRC Scouting Remote</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            max-width: 330px;
            margin: 0;
            background-color: #ccc;
            color: #fff;
           
        }

        h1 {
            text-align: left;
            font-size: 1.2rem;
            margin-top: -10px;
            margin-left:12px;
        }

        h2 {
            text-align: center;
            font-size: 1.2rem;
            margin-top: -10px;
            color: #ccc;
            
        }

        h3 {
            text-align: center;
            font-size: 1rem;
            margin-top: -10px;
            color: #ccc;
        }

        h4 {
            text-align: center;
            font-size: 0.8rem;
            margin-top: -10px;
            color: #ccc;
        }

        .content {
            padding-left: 10px;
            padding-right: 10px;
        }

        .buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .button {
            padding: 1.5rem;
            text-align: center;
            background-color: #111;
            color: #fff;
            border-radius: 5px;
            border: 1px solid #fff;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s;
        }

        .button:hover {
            background-color: #fff;
            color: #111;
        }

        .button.selected {
            background-color: #fff;
            color: #111;
        }

        .long-button {
            grid-column: span 2; /* Span across both columns */
        }

        .logo {
            width: 50%;
        }

        .info {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            justify-content: space-between;
        }

        .infoBlock {
            width: 47%;
            text-align: center;
            padding: 2px;
            border-radius: 5px;
            box-sizing: border-box;
        }

        #block {
            background-color: #111;
           left:0;
            position: relative;
            width:100vw;
            min-height:100vh;
        }

        #statusDisplay {
            position: absolute;
           
            width: 100%;
            text-align: center;
            font-size: 1.2rem;
            color: #fff;
        }

        #locationDisplay {
            grid-column: span 2; /* Spans both columns */
            text-align: center;
            font-size: 1rem;
            color: #fff;
            margin-top: 10px;
        }


        #scoreboard {
    width: 33vw;
    height: 33vw;
    border: 1px solid #fff;
    background-color: #111;
    float: right;
    margin-right: 12px;
     margin-top: 12px;
    display: flex;
    flex-direction: column; /* Stack timer and score vertically */
}
#timer,
#score {
    width: 100%;
    height: 50%;
    display: flex;
    align-items: center;  /* Vertically align content */
    justify-content: center; /* Horizontally align content */
    font-size: 4rem;
    color: white; /* Ensure text is visible */
    cursor:pointer;
}

#timer-inner,
#score-inner {
    margin: auto; /* Center content inside their parent */
}



@keyframes shake {
            0% { transform: translateX(0); }
             0% { transform: translateY(0); }
            15% { transform: translateY(-3px); }
            25% { transform: translateX(-3px); }
            35% { transform: translateY(3px); }
            50% { transform: translateX(3px); }
            65% { transform: translateY(-3px); }

            75% { transform: translateX(-3px); }
            85% { transform: translateY(3px); }
            100% { transform: translateX(3px); }
        }

        /* Class for applying shake effect */
        .shake {
            animation: shake 0.5s ease-in-out; /* 0.5s shake duration */
            animation-iteration-count: 1; /* Only shake once */
        }

@keyframes flash {
    0% { background-color: inherit; }   /* Keep the original background */
10% { background-color: #fff; }     /* Flash to white */
20% { background-color: inherit; }    /* Revert back to original */
30% { background-color: #fff; }     /* Flash to white */
40% { background-color: inherit; }     /* Revert back to original */
50% { background-color: #fff; }     /* Flash to white */
60% { background-color: inherit; }    /* Revert back to original */
70% { background-color: #fff; }     /* Flash to white */
80% { background-color: inherit; }    /* Revert back to original */   
90% { background-color: #fff; }     /* Flash to white */   
    100% { background-color: inherit; } /* Revert back to original */
}

.flash {
    animation: flash 1s ease-in-out; /* Flash effect for 1 second */
    animation-iteration-count: 1;
}
.swipeImg{width:20%;position: absolute;margin-top:-34px;}
#swipeRImg{float:left;}
#swipeLImg{float:right;}

#success{float:left;left:0;}
#failure{float:right;margin-right:20%;}


    </style>
</head>
<body>
    <div id="block">
        <img src="logo.png" class="logo" alt="Logo">
        <div id="scoreboard">
            <div id="timer">
                <div id="timer-inner">
                150
                </div>
            </div>
            <div id="score">
                <div id="score-inner">
                0
                </div>
            </div>
        </div>
        <h1>FRC Scouting Remote</h1>
        <h2 id="eventName"></h2>

        <div class="content">
            <!-- Info Section -->
            <div class="info">
                <div class="infoBlock">
                    <h3 id="matchNumber"></h3>
                </div>
                <div class="infoBlock">
                    <h3 id="robotName"></h3>
                </div>
            </div>

            <!-- Action Buttons for a button that spans both columns, add the class ' long-button' -->
            <div class="buttons">
                <div class="button" data-action="crosses_starting_line">
                    Crosses Starting Line
                </div>nbmkbmkjbdfs,mng,n
                <div class="button" data-action="scores_coral_level_1">Scores Coral Level 1</div>
                <div class="button" data-action="scores_coral_level_2">Scores Coral Level 2</div>
                <div class="button" data-action="scores_coral_level_3">Scores Coral Level 3</div>
                <div class="button" data-action="scores_coral_level_4">Scores Coral Level 4</div>
                <div class="button" data-action="picks_up_algae">Picks Up Algae</div>
                <div class="button" data-action="scores_algae_net">Scores Algae Net</div>
                <div class="button" data-action="scores_algae_processor">Scores Algae Processor</div>
                <div class="button" data-action="attempts_shallow_climb">Attempts Shallow Climb</div>
                <div class="button" data-action="attempts_deep_climb">Attempts Deep Climb</div>
                <div class="button" data-action="attempts_parked">Attempts to Park</div>
                
                <div class="button" data-action="plays_defense">Plays Defense</div>
                <div class="button" data-action="attempts_to_descore">Attempts to Descore</div>
            </div>

            <!-- Location Display -->
            <h3 id="locationDisplay">Location: </h3>
        </div>
<div id="success"><img src="success.png" class="swipeImg"></div>
<div id="failure"><img src="failure.png" class="swipeImg"></div>
        <!-- Status Display -->
        <div id="statusDisplay">Swipe to Submit</div>

<script>
  // Extract query parameters
const params = new URLSearchParams(window.location.search);
const event = params.get('event');
const match = params.get('match');
const robot = params.get('robot');
const alliance = params.get('alliance');

// Points setup
const auto_points = {
    "crosses_starting_line": 3,
    "scores_coral_level_1": 2,
    "scores_coral_level_2": 4,
    "scores_coral_level_3": 6,
    "scores_coral_level_4": 8,
    "picks_up_algae": 0,
    "scores_algae_net": 8,
    "scores_algae_processor": 12,
    "attempts_shallow_climb": 0, // Typically endgame, but zeroed out here
    "attempts_deep_climb": 0, // Typically endgame, but zeroed out here
    "attempts_parked": 0,     // Typically endgame, but zeroed out here
    "plays_defense": 0,
    "attempts_to_descore": 0,
};

const actions = {
    "crosses_starting_line": { "location": "starting_line", "points": 0 },
    "scores_coral_level_1": { "location": "reef", "points": 1 },
    "scores_coral_level_2": { "location": "reef", "points": 2 },
    "scores_coral_level_3": { "location": "reef", "points": 3 },
    "scores_coral_level_4": { "location": "reef", "points": 4 },
    "picks_up_algae": { "location": "mid_field", "points": 0 },
    "scores_algae_net": { "location": "net", "points": 4 },
    "scores_algae_processor": { "location": "processor", "points": 6 },
    "attempts_shallow_climb": { "location": "barge", "points": 6 },
    "attempts_deep_climb": { "location": "barge", "points": 12 },
    "attempts_parked": { "location": "barge", "points": 2 },
    "plays_defense": { "location": "opponent_side", "points": 0 },
    "attempts_to_descore": { "location": "opponent_reef", "points": 0 },
};

// Initial score setup
let score = 0;

// Timer setup
let timerValue = 150;  // Initial timer value (starts at 150)
let timerInterval;

// Update the page with selected data
document.getElementById('eventName').textContent = event
    ? ` ${event.replace(/_/g, ' ').replace(/\b\w/g, function(char) { return char.toUpperCase(); })}`
    : 'Unknown Event';
document.getElementById('matchNumber').textContent = match
    ? `Match #: ${match}`
    : 'Match #: N/A';
document.getElementById('robotName').textContent = robot
    ? `Robot #: ${robot}`
    : 'Robot #: N/A';

// Change the background color of #block based on alliance
const blockElement = document.getElementById('block');
if (alliance === 'Red Alliance') {
    blockElement.style.backgroundColor = '#C0392B' // Red
    document.body.style.backgroundColor = '#C0392B'; // Red
} else if (alliance === 'Blue Alliance') {
    blockElement.style.backgroundColor = '#2C3E50' // Blue
    document.body.style.backgroundColor = '#2C3E50'; // Blue
}

// Display the current location (from selected action)
function updateLocationDisplay() {
    const action = document.querySelector('.button.selected');
    const location = action ? actions[action.getAttribute('data-action')]?.location : 'Unknown';
    document.getElementById('locationDisplay').textContent = `Location: ${location}`;
}

// Event Listener for Buttons (selecting actions)
document.querySelectorAll('.button').forEach(button => {
    button.addEventListener('click', () => {
        // Remove "selected" class from all buttons
        document.querySelectorAll('.button').forEach(btn => btn.classList.remove('selected'));

        // Add "selected" class to the clicked button
        button.classList.add('selected');

        // Update location display based on selected action
        updateLocationDisplay();
    });
});

// Function to start the countdown timer
function startTimer() {

    
    
    // Trigger vibration when the timer starts
    if ("vibrate" in navigator) {
        navigator.vibrate(200); // Vibrate for 200ms when the timer starts
    }

    // Shake the screen when timer starts
    document.getElementById('scoreboard').classList.add('shake');
    
    // Update the timer value every second
    timerInterval = setInterval(function () {
        timerValue -= 1;
        document.getElementById('timer-inner').textContent = timerValue;



       // Check if time into match is 14, and trigger the flash effect
       const timeIntoMatch = 150 - timerValue;
       if (timeIntoMatch === 14) {
           blockElement.classList.add('flash'); // Add flash effect to the block container

           // Remove the flash class after 1 second to stop the flashing
           setTimeout(() => {
               blockElement.classList.remove('flash');
           }, 1000);
       }



        // Do not show an alert at 0 or 150, but stop the timer when it reaches 0
        if (timerValue <= 0) {
            clearInterval(timerInterval); // Stop the countdown when timer reaches 0
        }
    }, 1000);  // 1 second interval
}

// Add click event to the scoreboard to start the timer
document.getElementById('scoreboard').addEventListener('click', function () {
    if (timerValue === 150) {  // Start the timer only if it has not already started
        startTimer();
    }
});

// Function to show alerts with relevant details
function showAlert(action, location, timeIntoMatch, points, result) {
    // Log the details to the console or show as an alert
  //  alert(`Action: ${action}\nLocation: ${location}\nTime into match: ${timeIntoMatch} seconds\nPoints: ${points}\nResult: ${result}`);
  
    let scoreboardPoints = document.getElementById('score-inner').textContent;
    scoreboardPoints = parseInt(scoreboardPoints, 10); // Convert to a number
    scoreboardPoints += points; // Add points numerically
    document.getElementById('score-inner').textContent = scoreboardPoints;
}


// Call this function for both swipe right and swipe left
function handleSwipe(success) {
    const action = document.querySelector('.button.selected');
    const actionData = action ? actions[action.getAttribute('data-action')] : null;
    const location = actionData ? actionData.location : 'Unknown';

    // Calculate time into the match: 150 - (timerValue)
    const timeIntoMatch = 150 - timerValue;

    // Determine points based on time into the match
    let points = 0;
    if (timeIntoMatch < 15) {
        // Use auto points if time into match is less than 15 seconds
        points = auto_points[action.getAttribute('data-action')] || 0;
    } else {
        // Use normal action points if time into match is 15 seconds or more
        points = actions[action.getAttribute('data-action')]?.points || 0;
    }

    // If failure, points should be 0
    if (!success) {
        points = 0;
    }

    const statusDisplay = document.getElementById('statusDisplay');
    const result = success ? 'Success' : 'Failure';
    statusDisplay.textContent = result;

    // Only alert if time is between 1 and 149 seconds
    if (timerValue > 0 && timerValue < 150) {
        // Vibrate for 200ms on both success or failure
        if ("vibrate" in navigator) {
            navigator.vibrate(200);
        }

        // Show the alert
        showAlert(action.getAttribute('data-action'), location, timeIntoMatch, points, result);

        // Send data to the backend for insertion into the database
        const data = {
            ip_address: 'user-ip-address',  // Get user IP dynamically if needed
            event_name: event,
            match_no: match,
            time_sec: timeIntoMatch,
            robot: robot,
            alliance: alliance,
            action: action?.getAttribute('data-action'),
            location: location,
            result: result,
            points: points
        };

        // Send data via fetch
        fetch('insert_submission.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        })
        .then(response => response.json())
        .then(responseData => {
            console.log(responseData); // Handle the response from the server
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }
}

// Swipe functionality
let startX = 0;
blockElement.addEventListener('touchstart', (e) => {
    startX = e.touches[0].clientX; // Get initial touch position
});

blockElement.addEventListener('touchend', (e) => {
    const endX = e.changedTouches[0].clientX; // Get final touch position
    const diff = endX - startX; // Calculate swipe distance

    if (diff > 50) {
        // Swiped right (Success)
        handleSwipe(true);  // Pass true for success
    } else if (diff < -50) {
        // Swiped left (Failure)
        handleSwipe(false); // Pass false for failure
    } else {
        // Insufficient swipe distance
        document.getElementById('statusDisplay').textContent = 'Swipe to Submit';
    }
});



//timerInterval = setInterval(function () {
//        timerValue -= 1;
//        document.getElementById('timer-inner').textContent = timerValue;
//
//        // Check if time into match is 14, and trigger the flash effect
//        const timeIntoMatch = 150 - timerValue;
//        if (timeIntoMatch === 14) {
//            blockElement.classList.add('flash'); // Add flash effect to the block container
//
//            // Remove the flash class after 1 second to stop the flashing
//            setTimeout(() => {
//                blockElement.classList.remove('flash');
//            }, 1000);
//        }
//
//        // Do not show an alert at 0 or 150, but stop the timer when it reaches 0
//        if (timerValue <= 0) {
//            clearInterval(timerInterval); // Stop the countdown when timer reaches 0
//        }
//    }, 1000);  // 1 second interval




</script>






    </div>
</body>
</html>
